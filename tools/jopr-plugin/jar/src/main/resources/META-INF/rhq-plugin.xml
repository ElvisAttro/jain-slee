<?xml version="1.0" encoding="UTF-8" ?>

<plugin name="Mobicents-JSLEE" displayName="Mobicents JSLEE Server 2.x"
  package="org.rhq.plugins.jslee"
  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  description="Supports management and monitoring of Restcomm JAIN SLEE Server"
  xmlns="urn:xmlns:rhq-plugin" xmlns:c="urn:xmlns:rhq-configuration">

  <depends plugin="JMX" useClasses="true" />

  <server name="Mobicents JSLEE Server" classLoader="instance" class="JainSleeServerComponent"
    discovery="JainSleeServerDiscoveryComponent" description="Mobicents JAIN SLEE Server 2.x.y" supportsManualAdd="true">

    <plugin-configuration>
      <c:group name="connectionInfo">
        <c:simple-property name="namingURL" displayName="Naming Provider URL" description="The JBoss Naming Provider (JNP) URL with which to connect to the JBoss AS or EAP instance (e.g. jnp://127.0.0.1:1099)." />
        <c:simple-property name="principal" required="false" description="The name of the principal (i.e. user) to authenticate." />
        <c:simple-property name="credentials" type="password" required="false" description="The credentials (i.e. password) that should be used to authenticate the principal." />
        <c:simple-property name="homeDir" displayName="JBoss Home Directory" type="directory" readOnly="true" description="The absolute path to the directory where JBoss AS or EAP is installed (e.g. /opt/jboss-5.1.0.GA)." />
        <c:simple-property name="serverHomeDir" type="directory" readOnly="true" description="The path to the configuration directory under which this instance operates (e.g. /opt/jboss-5.2.0.GA/server/default); if the path is not absolute, then it will be resolved relative to {homeDir}." />
        <c:simple-property name="serverName" required="false" description="The name of the server configuration (e.g. minimal, default, or all); if not specified, it will default to the last path component of {serverHomeDir}." default="default" />
      </c:group>
    </plugin-configuration>

    <process-scan name="jbossas" query="process|basename|match=^java.*,arg|org.jboss.Main|match=.*" />

    <operation name="sleeState" displayName="Change Slee State" description="Start/Stop or Shutdown Restcomm SLEE Server. To Shutdown, the Restcomm JSLEE Server should be first Stopped">
      <parameters>
        <c:simple-property name="action" default="stop">
          <c:property-options>
            <c:option value="start" name="start" />
            <c:option value="stop" name="stop" />
            <c:option value="shutdown" name="shutdown" />
          </c:property-options>
        </c:simple-property>
      </parameters>
      <results>
        <c:simple-property name="result" />
      </results>
    </operation>

    <operation name="switchLoggingConfiguration" displayName="Change Global Logging Profile" description="Changes the Logging profile globally for the JBoss AS.">
      <parameters>
        <c:simple-property name="profile" default="DEFAULT">
          <c:property-options>
            <c:option value="DEFAULT" name="DEFAULT" />
            <c:option value="DEBUG" name="DEBUG" />
            <c:option value="PRODUCTION" name="PRODUCTION" />
          </c:property-options>
        </c:simple-property>
      </parameters>
      <results>
        <c:simple-property name="result" />
      </results>
    </operation>
    
    <operation name="getLoggingConfiguration" displayName="Get Logging Profile Configuration" description="Retrieves the contents for log4j profile configuration file.">
      <parameters>
        <c:simple-property name="profile" default="CURRENT">
          <c:property-options>
            <c:option value="CURRENT" name="CURRENT" />
            <c:option value="DEFAULT" name="DEFAULT" />
            <c:option value="DEBUG" name="DEBUG" />
            <c:option value="PRODUCTION" name="PRODUCTION" />
          </c:property-options>
        </c:simple-property>
      </parameters>
      <results>
        <c:simple-property name="result" />
      </results>
    </operation>

    <operation name="setLoggingConfiguration" displayName="Update Logging Profile Configuration" description="Updates the contents for log4j profile configuration file.">
      <parameters>
        <c:simple-property name="profile" default="CURRENT">
          <c:property-options>
            <c:option value="CURRENT" name="CURRENT" />
            <c:option value="DEFAULT" name="DEFAULT" />
            <c:option value="DEBUG" name="DEBUG" />
            <c:option value="PRODUCTION" name="PRODUCTION" />
          </c:property-options>
        </c:simple-property>
        <c:simple-property name="contents" displayName="Contents" summary="true" description="Profile Contents" />
      </parameters>
      <results>
        <c:simple-property name="result" />
      </results>
    </operation>

    <operation name="queryActivityContextLiveness" description="Queries Activity Context for liveness.">
      <results>
        <c:simple-property name="result" />
      </results>
    </operation>

    <!-- Congestion Control -->
    <operation name="ccSetMemOn" displayName="CC-SetMinFreeMemoryToTurnOn" description="Sets the minimum memory (percentage) that should be available to turn on congestion control.">
      <parameters>
        <c:simple-property name="value" default="10" />
      </parameters>
      <results>
        <c:simple-property name="result" />
      </results>
    </operation>

    <operation name="ccSetMemOff" displayName="CC-SetMinFreeMemoryToTurnOff" description="Sets the minimum memory (percentage) that should be available to turn off congestion control.">
      <parameters>
        <c:simple-property name="value" default="20" />
      </parameters>
      <results>
        <c:simple-property name="result" />
      </results>
    </operation>

    <operation name="ccSetCheckPeriod" displayName="CC-SetPeriodBetweenChecks" description="Sets the period in seconds to check if congestion control state should change. Use 0 to turn off congestion control.">
      <parameters>
        <c:simple-property name="value" default="0" />
      </parameters>
      <results>
        <c:simple-property name="result" />
      </results>
    </operation>

    <operation name="ccSetRefuseStartActivity" displayName="CC-SetRefuseStartActivity" description="Defines if the start of activity should be refused, when congestion control is on.">
      <parameters>
        <c:simple-property name="value" default="true">
          <c:property-options>
            <c:option value="true" name="true" />
            <c:option value="false" name="false" />
          </c:property-options>
        </c:simple-property>
      </parameters>
      <results>
        <c:simple-property name="result" />
      </results>
    </operation>

    <operation name="ccSetRefuseFireEvent" displayName="CC-SetRefuseFireEvent" description="Defines if the firing of an event should be refused, when congestion control is on.">
      <parameters>
        <c:simple-property name="value" default="false">
          <c:property-options>
            <c:option value="true" name="true" />
            <c:option value="false" name="false" />
          </c:property-options>
        </c:simple-property>
      </parameters>
      <results>
        <c:simple-property name="result" />
      </results>
    </operation>

		<operation name="viewEventRouterStatistics" description="View statistical information about Event Router">
      <parameters>
        <c:simple-property name="filter" default="executors">
          <c:property-options>
            <c:option value="global" name="Global" />
            <c:option value="executors" name="Executors" />
            <c:option value="eventTypes" name="Event Types" />
            <c:option value="executorsByEventTypes" name="Executors and Event Types" />
            <c:option value="all" name="All" />
          </c:property-options>
        </c:simple-property>
      </parameters>
		  <results>
		    <c:list-property name="statistics">
		      <c:map-property name="EventRouterStatistics">
		        <c:simple-property name="id" summary="true"/>
		        <c:simple-property name="activitiesMapped" summary="true" type="integer"/>
		        <c:simple-property name="averageEventRoutingTime" summary="true" type="integer"/>
		        <c:simple-property name="executedTasks" summary="true" type="integer"/>
		        <c:simple-property name="executingTime" summary="true" type="integer"/>
		        <c:simple-property name="idleTime" summary="true" type="integer"/>
            <c:simple-property name="miscTasksExecuted" summary="true" type="integer"/>
            <c:simple-property name="eventsRouted" summary="true" type="integer"/>
            <c:simple-property name="routingTime" summary="true" type="integer"/>
		      </c:map-property>
		    </c:list-property>
		  </results>
		</operation>

    <operation name="listActivityContexts" displayName="List all Activity Context" description="List all Activity Context details in this server">

      <results>
        <c:notes>...</c:notes>
        <c:list-property name="result">
          <c:map-property required="false" name="element">
            <c:simple-property required="false" name="ActivityHandle" />
            <c:simple-property required="false" name="Class" />
            <c:simple-property required="false" name="LastAccessTime" />
            <c:simple-property name="ResourceAdaptor" />
            <!-- List within Map still not supported. We will add when its available -->
            <!-- c:list-property
              name="SbbAttachments">
              <c:map-property
              name="SbbAttachment" -->
            <c:simple-property name="SbbAttachmentValue" />
            <!-- /c:map-property>
              
              </c:list-property>
              <c:list-property name="NamesBoundTo">
              <c:map-property
              name="NameBoundTo" -->
            <c:simple-property name="NameBoundToValue" />
            <!-- /c:map-property>
              </c:list-property>
              <c:list-property name="Timers">
              <c:map-property name="Timer" -->
            <c:simple-property name="TimerValue" />
            <!-- /c:map-property>
              </c:list-property>
              <c:list-property
              name="DataProperties">
              <c:map-property
              name="DataProperty" -->
            <c:simple-property name="DataPropertyValue" />
            <!-- /c:map-property>
              </c:list-property-->
          </c:map-property>
        </c:list-property>
      </results>
    </operation>

    <metric property="state" displayName="State" dataType="trait" displayType="summary" />

		<!-- Event Routing Statistics -->
	  <metric property="activitiesMapped" displayName="Activities Mapped" dataType="measurement" measurementType="trendsup" displayType="summary"
      description="Total activities mapped for all the event router executors" />
	  <metric property="averageEventRoutingTime" displayName="Average Event Routing Time" dataType="measurement" measurementType="dynamic" displayType="summary"
	    description="Average time spent to route one event (in ms)" />
	  <metric property="executedTasks" displayName="Executed Tasks" dataType="measurement" measurementType="trendsup" displayType="summary" 
	    description="Number of tasks executed, which is the sum of the events routed for each EventTypeID, and also the misc tasks executed" />
    <metric property="miscTasksExecuted" displayName="Misc Tasks Executed" dataType="measurement" measurementType="trendsup" displayType="summary"
      description="Number of misc tasks executed" />

    <service name="DeployableUnits" class="DeployableUnitComponent" discovery="DeployableUnitDiscoveryComponent" description="Deployable Units" createDeletePolicy="both" creationDataType="content">
      <plugin-configuration>
        <c:group name="general" displayName="General">
          <c:simple-property name="deploymentName" description="The name of this DU" readOnly="true" />
          <c:simple-property name="filename" readOnly="true" />
        </c:group>
        <c:group name="advanced" displayName="Advanced" hiddenByDefault="true">
          <c:simple-property name="extension" default="jar" readOnly="true" />
          <c:simple-property name="descriptionTemplate" default="Enterprise Application" readOnly="true" />
          <c:simple-property name="deploymentTypeName" default="JavaEEApplication" readOnly="true">
            <c:description>
              The name of the item from the org.jboss.deployers.spi.management.KnownDeploymentTypes enum corresponding to this deployment's type.
            </c:description>
          </c:simple-property>
        </c:group>
     </plugin-configuration>

      <operation name="listComponents" displayName="List Component IDs" description="Get the component identifiers of the components installed with this deployable unit">
        <results>
          <c:notes>...</c:notes>
          <c:list-property name="result">
            <c:map-property required="false" name="element">
              <c:simple-property required="false" name="Name" />
              <c:simple-property required="false" name="Vendor" />
              <c:simple-property required="false" name="Version" />
            </c:map-property>
          </c:list-property>
        </results>
      </operation>

      <content name="file" displayName="DU File" category="deployable" isCreationType="true">
        <configuration>
          <c:group name="deployment" displayName="Deployment Options">
            <c:simple-property name="persistentDeploy" type="boolean" required="true" default="true">
              <c:description>Should the archive be deployed in a persistent way (i.e. copied to deploy folder, will survive server restart, but no info on deploy success)?</c:description>
            </c:simple-property>
            <c:simple-property name="deployFarmed" type="boolean" required="true" default="false">
              <c:description>
                Should the archive be deployed as a cluster deployment (i.e. to the farm directory, rather than
                the deploy directory)? This option should only be set to Yes if this application server instance is
                a node in a cluster, otherwise the deployment will fail. If set to Yes, the Persistent Deploy property
                must be set to Yes, since non-persistent deployments to cluster are not supported.
              </c:description>
            </c:simple-property>
          </c:group>
        </configuration>
      </content>
    </service>

    <!-- JAIN SLEE Service Component -->
    <service name="Service" class="ServiceComponent" discovery="ServiceDiscoveryComponent" description="Services">
    
      <!-- Operation for Activating/Deactivating Services -->
      <operation name="changeServiceState" description="Activate / DeActivate Service.">
        <parameters>
          <c:simple-property name="action" default="activate">
            <c:property-options>
              <c:option value="activate" name="Activate" />
              <c:option value="deactivate" name="Deactivate" />
            </c:property-options>
          </c:simple-property>
        </parameters>
        <results>
          <c:simple-property name="result" />
        </results>
      </operation>

      <!-- Operation for Retrieving SBB Entities for Service -->
      <operation name="retrieveSbbEntities" description="Retrieve current SBB Entities for this Service">
        <results>
          <c:notes>...</c:notes>
          <c:list-property name="result">
            <c:map-property required="false" name="element">
              <c:simple-property required="false" name="SBB Entity Id" />
              <c:simple-property required="false" name="Parent SBB Entity Id" />
              <c:simple-property required="false" name="Priority" />
              <c:simple-property required="false" name="Attachment Count" />
            </c:map-property>
          </c:list-property>
        </results>
      </operation>

      <!-- Metric to show service state over time -->
      <metric property="state" displayName="State Code" dataType="trait" displayType="summary" />

      <!-- SBBs belonging to this Service -->
      <service name="ServiceSbb" class="ServiceSbbComponent" discovery="ServiceSbbDiscoveryComponent" description="SBBs">
        <!-- Metric to show service state over time -->
        <metric property="state" displayName="State Code" dataType="trait" displayType="summary" />
        <!-- Metric to show sbb entities for this service over time -->
        <metric property="SbbEntitiesCount" displayName="SBB Entities Count" dataType="trait" displayType="summary" />
        
        <!-- Usage Parameter Set -->
        <service name="UsageParameterSet" class="ServiceSbbUsageParameterSetComponent" discovery="ServiceSbbUsageParameterSetDiscoveryComponent" description="Usage Parameter Sets">
          <!-- Metric to show service state over time -->
          <metric property="state" displayName="State Code" dataType="trait" displayType="summary" />
          
          <!-- Where parameters will be displayed -->
          <resource-configuration>
            <c:list-property name="usageParameter">
              <c:map-property name="usageParameterDefinition">
                <c:simple-property name="usageParameterName" displayName="Name" summary="true" description="Name of Usage Parameter" />
                <c:simple-property name="usageParameterType" displayName="Type" summary="true" description="Type of Usage Parameter (Counter or Sample)">
                  <c:property-options>
                    <c:option value="Counter" />
                    <c:option value="Sample" />
                  </c:property-options>
                </c:simple-property>
                <c:simple-property name="usageParameterValue" displayName="Value" summary="true" description="Value of Usage Parameter" />
              </c:map-property>
            </c:list-property>
          </resource-configuration>
        </service>
      </service>
    </service>

    <!-- JAIN SLEE Event Router Executor Component -->
    <service name="Event Router Executor" class="ExecutorComponent" discovery="ExecutorDiscoveryComponent" description="Event Router Executors">
	    <metric property="activitiesMapped" displayName="Activities Mapped" dataType="measurement" measurementType="trendsup" displayType="summary"
	      description="Total activities mapped for all the event router executors" />
	    <metric property="averageEventRoutingTime" displayName="Average Event Routing Time" dataType="measurement" measurementType="dynamic" displayType="summary"
	      description="Average time spent to route one event (in ms)" />
      <metric property="executedTasks" displayName="Executed Tasks" dataType="measurement" measurementType="trendsup" displayType="summary" 
        description="Number of tasks executed, which is the sum of the events routed for each EventTypeID, and also the misc tasks executed" />
      <metric property="executingTime" displayName="Executing Time" dataType="measurement" measurementType="trendsup" displayType="summary" 
        description="Time spent on executing tasks, which is the sum of the time spent routing events for each EventTypeID, and also the time spent executing the misc tasks." />
      <metric property="idleTime" displayName="Idle Time" dataType="measurement" measurementType="trendsup" displayType="summary" 
        description="Total time the executor was idle, i.e., not executing tasks." />
      <metric property="miscTasksExecuted" displayName="Misc Tasks Executed" dataType="measurement" measurementType="trendsup" displayType="summary"
        description="Number of misc tasks executed" />
      <metric property="miscTasksExecutingTime" displayName="Misc Tasks Executing Time" dataType="measurement" measurementType="trendsup" displayType="summary"
        description="Time spent executing misc tasks." />
    </service>

    <!-- JAIN SLEE SBB Component -->
    <service name="Sbb" class="SbbComponent" discovery="SbbDiscoveryComponent" description="SBBs">
      <!-- Metric to show service state over time -->
      <metric property="state" displayName="State Code" dataType="trait" displayType="summary" />
      <!-- Metric to show sbb entities for this service over time -->
      <metric property="SbbEntitiesCount" displayName="SBB Entities Count" dataType="trait" displayType="summary" />
    </service>

    <!-- JAIN SLEE Resource Adaptor Component -->
    <service name="ResourceAdaptor" class="ResourceAdaptorComponent" discovery="ResourceAdaptorDiscoveryComponent"   description="Resource Adaptors">

      <metric property="entities" displayName="Entities Active" measurementType="dynamic" displayType="summary" description="Number of currently active Entities irrespective of Entities State" />
      <metric property="ratype" dataType="trait" displayType="summary" displayName="Resource Adaptor Type" defaultInterval="86400" />

      <resource-configuration>
        <c:list-property name="properties">
          <c:map-property name="propertyDefinition">
            <c:simple-property name="propertyName" displayName="Property Name" summary="true" description="name of the property" />
            <c:simple-property name="propertyType" displayName="Type" summary="true" description="Java type of the property">
              <c:property-options>
                <c:option value="java.lang.String" />
                <c:option value="java.lang.Integer" />
                <c:option value="java.lang.Long" />
              </c:property-options>
            </c:simple-property>
            <c:simple-property name="propertyValue" displayName="Value" summary="true" description="Property value" />
          </c:map-property>
        </c:list-property>
      </resource-configuration>

      <service name="ResourceAdaptorEntity" class="RAEntityComponent" discovery="RAEntityDiscoveryComponent"
        description="Resource Adaptor Entity" createDeletePolicy="both" creationDataType="configuration">


        <operation name="changeRaEntityState" description="Activate / DeActivate RA Entity. To Remove RA Entity, use Delete Resource">
          <parameters>
            <c:simple-property name="action" default="activate">
              <c:property-options>
                <c:option value="activate" name="Activate" />
                <c:option value="deactivate" name="Deactivate" />
              </c:property-options>
            </c:simple-property>
          </parameters>
          <results>
            <c:simple-property name="result" />
          </results>
        </operation>

        <operation name="listActivityContexts" displayName="List Activity Context" description="List Activity Context details for this Resource Adaptor Entity">

          <results>
            <c:notes>...</c:notes>
            <c:list-property name="result">
              <c:map-property required="false" name="element">
                <c:simple-property required="false" name="ActivityHandle" />
                <c:simple-property required="false" name="Class" />
                <c:simple-property required="false" name="LastAccessTime" />
                <c:simple-property name="ResourceAdaptor" />

                <!-- List within Map still not supported. We will add when its available -->
                <!-- c:list-property name="SbbAttachments">
                  <c:map-property name="SbbAttachment" -->
                <c:simple-property name="SbbAttachmentValue" />
                <!-- /c:map-property>
                  
                  </c:list-property>
                  <c:list-property name="NamesBoundTo">
                  <c:map-property name="NameBoundTo" -->
                <c:simple-property name="NameBoundToValue" />
                <!-- /c:map-property>
                  </c:list-property>
                  <c:list-property name="Timers">
                  <c:map-property name="Timer" -->
                <c:simple-property name="TimerValue" />
                <!-- /c:map-property>
                  </c:list-property>
                  <c:list-property name="DataProperties">
                  <c:map-property name="DataProperty" -->
                <c:simple-property name="DataPropertyValue" />
                <!-- /c:map-property>
                  </c:list-property-->
              </c:map-property>
            </c:list-property>
          </results>
        </operation>

        <metric property="state" displayName="State" dataType="trait" displayType="summary" />
        <metric property="activites" displayName="Activites Live" measurementType="dynamic" displayType="summary" description="Number of currently live Activities" />

        <resource-configuration>
          <c:simple-property name="entityName" displayName="Entity Name" />
          <c:list-property name="properties">
            <c:map-property name="propertyDefinition">
              <c:simple-property name="propertyName" displayName="Property Name" summary="true" description="name of the property" />
              <c:simple-property name="propertyType" displayName="Type" summary="true" description="Java type of the property">
                <c:property-options>
                  <c:option value="java.lang.String" />
                  <c:option value="java.lang.Integer" />
                  <c:option value="java.lang.Long" />
                </c:property-options>
              </c:simple-property>
              <c:simple-property name="propertyValue" displayName="Value" summary="true" description="Property value" />
            </c:map-property>
          </c:list-property>
        </resource-configuration>

        <service name="ResourceAdaptorEntityLink" class="RAEntityLinkComponent" discovery="RAEntityLinkDiscoveryComponent"
          description="Resource Adaptor Entity Link" createDeletePolicy="both" creationDataType="configuration">

          <operation name="listBoundSbbs" displayName="List bound Sbbs" description="List all Sbb bound to this link">
            <results>
              <c:notes>...</c:notes>
              <c:list-property name="result">
                <c:map-property required="false" name="element">
                  <c:simple-property required="false" name="SbbName" />
                  <c:simple-property required="false" name="SbbVendeor" />
                  <c:simple-property required="false" name="SbbVersion" />
                </c:map-property>
              </c:list-property>
            </results>
          </operation>

          <resource-configuration>
            <c:simple-property name="linkName" displayName="Link Name" />
          </resource-configuration>
        </service>
    
      </service>
    </service>
  </server>
</plugin>